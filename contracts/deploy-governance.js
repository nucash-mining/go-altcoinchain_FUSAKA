const { ethers } = require('ethers');

const RPC_URL = 'http://127.0.0.1:8332';
const CHAIN_ID = 2330;

// Contract bytecode
const BYTECODE = '0x608060405234801561001057600080fd5b50600080546001600160a01b031916331790556105b6806100326000396000f3fe608060405234801561001057600080fd5b506004361061009e5760003560e01c80638da5cb5b116100665780638da5cb5b1461016e5780638f94cd1d14610181578063a76bbd9f14610189578063ad2bb1b3146101b5578063f2fde38b146101c857600080fd5b80631791324a146100a3578063186d9d88146100db578063434bebd9146100f057806344da09a91461014357806368ad609d1461014b575b600080fd5b6100be735ccccb6d334197c7c4ba94e7873d0ef11381cd4e81565b6040516001600160a01b0390911681526020015b60405180910390f35b6100ee6100e936600461050f565b6101db565b005b735ccccb6d334197c7c4ba94e7873d0ef11381cd4e60005260016020527f01d5b55893ca2b13d7a9be708bc78245f4e615b9da17154c6d571bcc312b91695460ff165b60405190151581526020016100d2565b6100ee61026a565b61013361015936600461050f565b60016020526000908152604090205460ff1681565b6000546100be906001600160a01b031681565b6100ee610312565b61013361019736600461050f565b6001600160a01b031660009081526001602052604090205460ff1690565b6100ee6101c336600461050f565b6103b8565b6100ee6101d636600461050f565b610434565b6000546001600160a01b0316331461020e5760405162461bcd60e51b81526004016102059061053f565b60405180910390fd5b6001600160a01b038116600081815260016020818152604092839020805460ff191690921790915590514281527f0ccaefd9d2631e53c2ba7f5e4a105d4b2921b85e7e4b0170f946dce574c11c1891015b60405180910390a250565b6000546001600160a01b031633146102945760405162461bcd60e51b81526004016102059061053f565b735ccccb6d334197c7c4ba94e7873d0ef11381cd4e6000819052600160209081527f01d5b55893ca2b13d7a9be708bc78245f4e615b9da17154c6d571bcc312b9169805460ff191690556040514281527f237e90b93b691616adecd2da0d14874d618607861dc1463b9f57c7d19fc60b5d91015b60405180910390a2565b6000546001600160a01b0316331461033c5760405162461bcd60e51b81526004016102059061053f565b735ccccb6d334197c7c4ba94e7873d0ef11381cd4e6000819052600160208181527f01d5b55893ca2b13d7a9be708bc78245f4e615b9da17154c6d571bcc312b9169805460ff19169092179091556040514281527f0ccaefd9d2631e53c2ba7f5e4a105d4b2921b85e7e4b0170f946dce574c11c189101610308565b6000546001600160a01b031633146103e25760405162461bcd60e51b81526004016102059061053f565b6001600160a01b03811660008181526001602052604090819020805460ff19169055517f237e90b93b691616adecd2da0d14874d618607861dc1463b9f57c7d19fc60b5d9061025f9042815260200190565b6000546001600160a01b0316331461045e5760405162461bcd60e51b81526004016102059061053f565b6001600160a01b0381166104b45760405162461bcd60e51b815260206004820181905260248201527f4e6577206f776e65722063616e6e6f74206265207a65726f20616464726573736044820152606401610205565b600080546040516001600160a01b03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a3600080546001600160a01b0319166001600160a01b0392909216919091179055565b60006020828403121561052157600080fd5b81356001600160a01b038116811461053857600080fd5b9392505050565b60208082526021908201527f4f6e6c79206f776e65722063616e2063616c6c20746869732066756e6374696f6040820152603760f91b60608201526080019056fea2646970667358221220ef47ab0059abb755627eaf228c108f2242104d8df4f349c6ec411693eaa2141064736f6c634300080d0033';

// Contract ABI
const ABI = [
  "function owner() view returns (address)",
  "function unblocked(address) view returns (bool)",
  "function isUnblocked(address) view returns (bool)",
  "function isXeggeXUnblocked() view returns (bool)",
  "function unblockXeggeX()",
  "function blockXeggeX()",
  "function unblockAddress(address)",
  "function blockAddress(address)",
  "function transferOwnership(address)",
  "function XEGGEX_WALLET() view returns (address)"
];

async function main() {
  // Get private key from command line
  const privateKey = process.argv[2];

  if (!privateKey) {
    console.log('Usage: node deploy-governance.js <private_key>');
    console.log('\nTo get your private key, unlock your wallet in the GUI and export it.');
    process.exit(1);
  }

  const provider = new ethers.providers.JsonRpcProvider(RPC_URL, CHAIN_ID);
  const wallet = new ethers.Wallet(privateKey, provider);

  console.log('Deploying XeggeXGovernance contract...');
  console.log('Deployer address:', wallet.address);

  const balance = await provider.getBalance(wallet.address);
  console.log('Deployer balance:', ethers.utils.formatEther(balance), 'ALT');

  // Deploy contract
  const factory = new ethers.ContractFactory(ABI, BYTECODE, wallet);

  console.log('\nSending deployment transaction...');
  const contract = await factory.deploy({
    gasLimit: 1000000
  });

  console.log('Transaction hash:', contract.deployTransaction.hash);
  console.log('Waiting for confirmation...');

  await contract.deployed();

  console.log('\n========================================');
  console.log('XeggeXGovernance deployed successfully!');
  console.log('Contract address:', contract.address);
  console.log('========================================');

  console.log('\nOwner:', await contract.owner());
  console.log('XeggeX Wallet:', await contract.XEGGEX_WALLET());
  console.log('XeggeX Currently Unblocked:', await contract.isXeggeXUnblocked());

  console.log('\n--- UPDATE GETH CODE ---');
  console.log('Add this address to params/xeggex.go:');
  console.log(`var XeggeXGovernanceContract = common.HexToAddress("${contract.address}")`);
}

main().catch(console.error);
